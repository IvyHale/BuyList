<!DOCTYPE html>
<html>

<head lang="uk">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <title>Buy List</title>


    <link rel="stylesheet" type="text/css" href="main.css" />
</head>

<body>
    <div class="bl-background">
        <div class="container">
            <div class="bl-list">
                <div class="bl-list-container">
                    <div class="bl-input">
                        <div class="addform">
                            <input class="addinpt" type="text" placeholder="Назва товару">
                            <button class="addbtn" data-tooltip="tooltip1" onclick="addProduct()">Додати</button>
                        </div>
                    </div>
                    <div class="bl-product">
                        <div class="bl-product-container">
                            <div class="productname"><span>Помідори</span></div>
                            <div class="bl-count">
                                <button data-tooltip="tooltip2" class="bl-minus">–</button>
                                <span class="bl-label">1</span>
                                <button data-tooltip="tooltip3" class="bl-plus">+</button>
                            </div>
                            <div class="bl-buttons">
                                <button data-tooltip="tooltip4" class="boughtbtn">Куплено</button>
                                <button data-tooltip="tooltip5" class="delbtn">x</button>
                            </div>
                        </div>
                    </div>
                    <div class="bl-product">
                        <div class="bl-product-container">
                            <div class="productname"><span>Печиво</span></div>
                            <div class="bl-count">
                                <button data-tooltip="tooltip6" class="bl-minus">–</button>
                                <span class="bl-label">1</span>
                                <button data-tooltip="tooltip7" class="bl-plus">+</button>
                            </div>
                            <div class="bl-buttons">
                                <button data-tooltip="tooltip8" class="boughtbtn">Куплено</button>
                                <button data-tooltip="tooltip9" class="delbtn">x</button>
                            </div>
                        </div>
                    </div>
                    <div class="bl-product">
                        <div class="bl-product-container">
                            <div class="productname"><span>Сир</span></div>
                            <div class="bl-count">
                                <button data-tooltip="tooltip10" class="bl-minus">–</button>
                                <span class="bl-label">1</span>
                                <button data-tooltip="tooltip11" class="bl-plus">+</button>
                            </div>
                            <div class="bl-buttons">
                                <button data-tooltip="tooltip12" class="boughtbtn">Куплено</button>
                                <button data-tooltip="tooltip13" class="delbtn">x</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bl-bought">
                <div class="bl-bought-container">
                    <div class="bl-title">Залишилося</div>
                    <div class="b-left">
                        <div class="b-left-container">
                            <span class="b-left-prod">
                    <span class="left-label">Помідори</span>
                            <span class="count-label">1</span>
                            </span>
                            <span class="b-left-prod">
                    <span class="left-label">Печиво</span>
                            <span class="count-label">1</span>
                            </span>
                            <span class="b-left-prod">
                    <span class="left-label">Хліб</span>
                            <span class="count-label">1</span>
                            </span>
                        </div>
                    </div>
                    <div class="bl-title">Куплено</div>
                    <div class="b-bought">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="badge">
        <p class="buylist">Buy List</p>
        <div class="badge-contains">
            <p class="created">Created by:</p>
            <p class="name">Mariia Malitska</p>
        </div>
    </div>





    <script>
        var showingTooltip;
        var node = $(".bl-product").first().clone();
        var leftProd = $(".b-left-prod").first().clone();

        function ready() {
            addDel();
            addBought();
            minusDisable();
            $(".productname > span").on("click", function() {
                changeName($(this));
            });
        }

        window.onload = function() {
            ready();
        }

        function minusDisable() {
            var prods = $(".bl-product");
            prods.each(function(i, elem) {
                $(elem).find(".bl-minus").prop('disabled', true);
                $(elem).find(".bl-minus").click(function() {
                    decCount($(elem));
                });
                $(elem).find(".bl-plus").click(function() {
                    incCount($(elem));
                });
            });
        }

        function decCount(elem) {
            var count = $(elem).find(".bl-label").text();
            count = count - 1;
            if (count == 1) {
                $(elem).find(".bl-minus").prop('disabled', true);
            }
            var index = $(".bl-product").index(elem);
            //                alert(index);
            $(".b-left-container").find(".b-left-prod").eq(index).find(".count-label").text(count);
            $(elem).find(".bl-label").text(count)

        }

        function incCount(elem) {
            var count = $(elem).find(".bl-label").text();
            count++;
            if (count > 1) {
                $(elem).find(".bl-minus").prop('disabled', false);
            }
            var index = $(".bl-product").index(elem);
            //                alert(index);
            $(".b-left-container").find(".b-left-prod").eq(index).find(".count-label").text(count);
            $(elem).find(".bl-label").text(count);
        }

        function addDel() {
            var prods = $(".bl-product");
            prods.each(function(i, elem) {
                $(elem).find(".delbtn").click(function() {
                    var index = $(".bl-product").index($(elem));
                    //                alert(index);
                    $(".b-left-container").find(".b-left-prod").eq(index).remove();
                    $(elem).remove();
                    delTooltip();
                });
            });
        }

        function addBought() {
            var prods = $(".bl-product");

            prods.each(function(i, elem) {
                $(elem).find(".boughtbtn").click(function() {
                    $(elem).attr('class', 'bl-product-bought');
                    changeToBought($(elem));
                });
            });
        }

        function changeToBought(elem) {
            $(elem).find(".delbtn").css("display", "none");
            $(elem).find(".bl-minus").css("visibility", "hidden");
            $(elem).find(".bl-plus").css("visibility", "hidden");
            $(elem).find(".productname").css("text-decoration", "line-through");
            $(elem).find(".boughtbtn").text("Не куплено");

            $(elem).find(".boughtbtn").attr('class', 'notboughtbtn');
            $(elem).find(".notboughtbtn").click(function() {
                $(elem).attr('class', 'bl-product');
                changeToNotBought($(elem));
            });

        }

        function changeToNotBought(elem) {
            $(elem).find(".delbtn").css("display", "inline-block");
            $(elem).find(".bl-minus").css("visibility", "visible");
            $(elem).find(".bl-plus").css("visibility", "visible");
            $(elem).find(".productname").css("text-decoration", "none");
            $(elem).find(".notboughtbtn").text("Куплено");
            $(elem).find(".notboughtbtn").attr('class', 'boughtbtn');
            $(elem).find(".boughtbtn").click(function() {
                $(elem).attr('class', 'bl-product-bought');
                changeToBought($(elem));
            });
        }



        document.onmouseover = function(e) {
            var target = e.target;

            var tooltip = target.getAttribute('data-tooltip');
            if (!tooltip) return;

            var tooltipElem = document.createElement('div');
            tooltipElem.className = 'tooltip';
            tooltipElem.innerHTML = target.getAttribute('data-tooltip');
            document.body.appendChild(tooltipElem);


            var coords = target.getBoundingClientRect();

            var left = coords.left + (target.offsetWidth - tooltipElem.offsetWidth) / 2;
            if (left < 0) left = 0;

            var top = coords.top - tooltipElem.offsetHeight - 5;
            if (top < 0) {
                top = coords.top + target.offsetHeight + 5;
            }

            tooltipElem.style.left = left + 'px';
            tooltipElem.style.top = top + 'px';

            showingTooltip = tooltipElem;

            document.getElementsByClassName('tooltip')[0].className += ' loaded';
        };

        document.onmouseout = function(e) {
            delTooltip();
            
        };

        function delTooltip(){
            if (showingTooltip) {
                showingTooltip.style.opacity = 0;
                showingTooltip.className = 'tooltip';
                document.body.removeChild(showingTooltip);
                showingTooltip = null;
            }
        }

        function addProduct() {
            var span = $("<span></span>").text(document.getElementsByClassName("addinpt")[0].value);
            node.find(".productname").text("");
            node.find(".productname").append(span);
            document.getElementsByClassName("addinpt")[0].value = "";
            node.find(".bl-label").text("1");
            node.appendTo(".bl-list-container");

            leftProd.find(".left-label").text(node.find(".productname").text());
            leftProd.find(".count-label").text("1");
            leftProd.appendTo(".b-left-container");

            leftProd = $(".b-left-prod").first().clone();

            node = $(".bl-product").first().clone();

            //            $(".productname > span").on("click", function() {
            //                changeName($(this));
            //            });

            document.getElementsByClassName("addinpt")[0].focus();

            ready();


        }




        $(window).on("resize", function() {
            var width = window.innerWidth;
            if (width < 720) {
                $(".bl-list").css("width", "100%");
                $(".bl-bought").css("width", "100%");
                $(".bl-background").css("width", "95%");
            } else {
                $(".bl-list").css("width", "65%");
                $(".bl-bought").css("width", "29%");
                $(".bl-background").css("width", "85%");
            }
        }).resize();

        function changeName(elem) {
            var name = $(elem).text();
            var curNode = $(elem);
            $(elem).text("");
            $(elem).append("<input type='text' class='editname'></input>")
            $(elem).find(".editname").val(name);
            $(elem).find(".editname").focus();
            $(elem).find(".editname").on("focusout", function() {
                //                alert($(this).parent().parent().parent().html());
                var index = $(".bl-product").index($(this).parent().parent().parent().parent());
                //                alert(index);
                name = $(this).val();
                $(".b-left-container").find(".b-left-prod").eq(index).find(".left-label").text(name);
                curNode.text(name);
                $(this).remove();
            });
        }

    </script>

</body>

</html>
